<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Рабочее место — ИИ-оркестр экспертизы</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <header>
      <h1>ИИ-оркестр экспертизы</h1>
      <div class="nav-tabs">
        <button id="tab-chat" class="active" data-target="chat-view">Чат и карточка</button>
        <button id="tab-registry" data-target="registry-view">Реестр карточек</button>
      </div>
    </header>

    <main>
      <section id="chat-view" class="layout">
        <div class="panel" id="assistant-panel">
          <div class="panel-header">
            <div>
              <h2>Поисковый ассистент</h2>
              <p class="muted">Введите вопрос, подберите карточки и отметьте подходящие</p>
            </div>
            <div class="assistant-actions">
              <button id="assistant-clear" class="link-button">Очистить подборку</button>
            </div>
          </div>

          <div class="assistant-query-block">
            <label class="full-width">
              Поисковый запрос
              <textarea
                id="assistant-query"
                rows="3"
                placeholder="Например: Как формируется XML акта освидетельствования в ИСУП?"
              ></textarea>
            </label>
            <div class="assistant-controls">
              <div class="assistant-filters">
                <div class="filter-row">
                  <label class="filter-chip">
                    <input type="checkbox" value="green" class="status-filter" />
                    Зеленые
                  </label>
                  <label class="filter-chip">
                    <input type="checkbox" value="yellow" class="status-filter" />
                    Желтые
                  </label>
                  <label class="filter-chip">
                    <input type="checkbox" value="red" class="status-filter" />
                    Красные
                  </label>
                  <label class="filter-chip">
                    <input type="checkbox" value="grey" class="status-filter" />
                    Серые
                  </label>
                </div>
                <div class="filter-row">
                  <label>
                    Домен
                    <select id="assistant-domain-filter">
                      <option value="">Все домены</option>
                    </select>
                  </label>
                  <label>
                    Сортировка
                    <select id="assistant-sort">
                      <option value="relevance">По релевантности</option>
                      <option value="verification">По дате верификации</option>
                      <option value="title">По заголовку</option>
                    </select>
                  </label>
                </div>
              </div>
              <div class="assistant-buttons">
                <button id="assistant-search" class="primary">Подобрать</button>
                <span class="muted">Ctrl + Enter</span>
              </div>
            </div>
          </div>

          <div class="selection-toolbar">
            <div class="selection-buttons">
              <button id="mark-all" class="link-button">Отметить все</button>
              <button id="unmark-all" class="link-button">Снять отметки</button>
              <button id="only-selected" class="link-button">Показать только выбранные</button>
              <button id="only-unselected" class="link-button">Показать только не выбранные</button>
              <button id="choose-recommended" class="link-button">Выбрать только актуальные и рекомендуемые</button>
            </div>
            <div class="selection-summary" id="selection-summary">Выбрано источников: 0</div>
          </div>

          <div class="assistant-results" id="assistant-results"></div>
        </div>

        <div class="card-details">
          <div class="panel card-detail-panel" id="card-detail-panel">
            <div class="card-detail-header">
              <div>
                <p class="muted">Карточка экспертизы</p>
                <h2 id="detail-title">Выберите карточку из подборки</h2>
                <div id="detail-subtitle" class="detail-subtitle">Чтобы увидеть подробности, отметьте карточку слева</div>
                <div id="detail-tags" class="detail-tags"></div>
              </div>
              <div id="detail-status" class="detail-status"></div>
            </div>

            <div class="detail-snapshot">
              <div id="detail-meta" class="detail-meta-grid muted">
                <div class="meta-placeholder">Данные станут доступны после выбора карточки.</div>
              </div>
              <div id="detail-stats" class="detail-stats"></div>
            </div>

            <div class="detail-section">
              <div class="detail-section-header">
                <h3>Основной текст</h3>
                <span class="badge" id="detail-updated">—</span>
              </div>
              <div id="detail-content" class="detail-text muted">Нет активной карточки</div>
            </div>

            <div class="detail-section" id="detail-highlights">
              <div class="detail-section-header">
                <h4>Ключевые фрагменты</h4>
                <span class="badge">авторазбиение по абзацам</span>
              </div>
              <div class="highlight-grid muted">Появится после выбора карточки</div>
            </div>

            <div class="detail-section two-column">
              <div>
                <div class="detail-section-header">
                  <h4>Источники</h4>
                  <span class="badge" id="detail-sources-count">0</span>
                </div>
                <div id="detail-sources" class="detail-cards muted">Нет данных</div>
              </div>
              <div>
                <div class="detail-section-header">
                  <h4>Журнал событий</h4>
                  <span class="badge" id="detail-events-count">0</span>
                </div>
                <div id="detail-events" class="detail-cards muted">Нет данных</div>
              </div>
            </div>
          </div>

          <div class="panel chat-panel">
            <div class="chat-header">
              <div>
                <h2>Чат по выбранным источникам</h2>
                <p class="muted">Выберите карточки слева, чтобы активировать чат</p>
              </div>
              <div class="chat-toggles">
                <label class="filter-chip">
                  <input type="checkbox" id="hide-sources-toggle" /> Скрыть источники в ответах
                </label>
              </div>
            </div>

            <div class="chat-info-grid">
              <div class="info-card" id="chat-source-card">
                <div class="info-card-title">Набор источников</div>
                <div class="info-card-content">
                  <p id="chat-source-status" class="status-label">Текущий набор источников пуст</p>
                  <p class="muted small">Добавьте карточки слева — они станут основой для эксперта в чате.</p>
                </div>
              </div>

              <div class="info-card">
                <div class="info-card-title">Задача чата</div>
                <div class="info-card-content">
                  <p class="muted small">
                    Эксперт должен ответить на вопрос пользователя, опираясь только на выбранные источники и
                    объясняя уверенность в каждом фрагменте ответа.
                  </p>
                </div>
              </div>

              <div class="info-card">
                <div class="info-card-title">Моделирование поведения</div>
                <div class="info-card-content">
                  <p class="muted small">Представь себя экспертом, который знает только добавленные источники.</p>
                  <ul class="info-list">
                    <li>Если в источниках нет ответа — честно говори об этом.</li>
                    <li>Если ответ неполный — дай то, что есть, и уточни, что информации недостаточно.</li>
                  </ul>
                </div>
              </div>

              <div class="info-card">
                <div class="info-card-title">Правила безопасности</div>
                <div class="info-card-content">
                  <ul class="info-list">
                    <li>Ссылайся только на выбранные карточки.</li>
                    <li>Не выдумывай факты и не скрывай неизвестность.</li>
                    <li>Оценивай достоверность данных и указывай уверенность.</li>
                  </ul>
                </div>
              </div>
            </div>

            <div class="selected-chips" id="selected-chips"></div>

            <div class="selected-list-panel">
              <div class="selected-list-header">
                <div>
                  <h3>Набор карточек</h3>
                  <p class="muted small">Список источников, которые попадут в контекст эксперта</p>
                </div>
                <div class="selected-count" id="selected-count-label">0</div>
              </div>
              <div class="selected-list" id="selected-list"></div>
            </div>
            <div class="chat-toolbar">
              <div class="chat-set-info" id="chat-set-info">Текущий набор источников: 0</div>
              <div class="chat-buttons">
                <button id="clear-selected" class="link-button">Очистить выбранные источники</button>
                <button id="clear-chat" class="link-button">Очистить чат</button>
                <button id="restore-chat" class="link-button">Вернуть предыдущий чат</button>
                <button id="export-chat" class="link-button">Экспортировать всю историю чата</button>
              </div>
            </div>

            <div class="chat-history" id="chat-history"></div>

            <div class="chat-input" id="prechat-composer">
              <input id="prechat-input" type="text" placeholder="Текст первого вопроса" />
              <button id="prechat-send" class="primary">Начать чат</button>
            </div>

            <div class="chat-input hidden" id="chat-composer">
              <input id="chat-input" type="text" placeholder="Введите сообщение" />
              <button id="chat-send" class="primary">Отправить</button>
            </div>

            <div class="chat-blocker hidden" id="chat-blocker">Выберите хотя бы одну карточку слева, чтобы начать диалог</div>
          </div>
        </div>
      </section>

      <section id="registry-view" class="hidden">
        <div class="panel">
          <div class="registry-header">
            <h2>Реестр карточек</h2>
            <div class="registry-actions">
              <button id="create-card" class="primary">Создать карточку</button>
              <button class="link-button" id="import-cards">Импорт из файла</button>
              <button class="link-button" id="export-cards">Экспорт выбранных</button>
              <button class="link-button" id="check-sla">Проверить статусы (SLA)</button>
              <button class="link-button" id="archive-cards">Архивировать</button>
              <input id="registry-search" type="text" placeholder="Поиск по ID, заголовку, тегам" />
            </div>
          </div>
          <div class="registry-filters">
            <div class="filter-row">
              <select id="registry-domain">
                <option value="">Все домены</option>
              </select>
              <select id="registry-status">
                <option value="">Все статусы</option>
                <option value="draft">draft</option>
                <option value="active">active</option>
                <option value="archived">archived</option>
              </select>
              <select id="registry-sort">
                <option value="updated">По дате актуализации</option>
                <option value="title">По заголовку</option>
              </select>
              <select id="registry-domain-mode">
                <option value="all">Все домены</option>
              </select>
            </div>
            <div class="filter-row">
              <input type="text" placeholder="Ответственный" id="registry-owner" />
              <input type="text" placeholder="Ревьюер" id="registry-reviewer" />
              <label class="filter-chip"><input type="checkbox" id="registry-only-mine" /> Только мои</label>
              <select id="registry-conf">
                <option value="">Конфиденциальность</option>
                <option value="public">Публично</option>
                <option value="internal">Внутренняя</option>
              </select>
            </div>
            <div class="filter-row">
              <label class="filter-chip">Проверено с <input type="date" id="registry-verified-from" /></label>
              <select id="registry-page-size">
                <option value="10">На странице: 10</option>
                <option value="20">20</option>
                <option value="50">50</option>
              </select>
              <div class="view-toggle" aria-label="Вид реестра">
                <button id="registry-view-table" class="toggle active">Таблица</button>
                <button id="registry-view-compact" class="toggle">Компактно</button>
              </div>
              <button id="registry-apply" class="primary">Применить</button>
            </div>
          </div>

          <table class="registry-table" id="registry-table">
            <thead>
              <tr>
                <th>Выб</th>
                <th>ID / UID</th>
                <th>Наименование</th>
                <th>Тип</th>
                <th>Версия</th>
                <th>Статус</th>
                <th>Домен</th>
                <th>Ответственный / Ревьюер</th>
                <th>Последняя проверка</th>
                <th>Следующая проверка</th>
                <th>Исп.</th>
                <th>Лайки</th>
                <th>Закладки</th>
                <th>Конф.</th>
                <th>Связи</th>
                <th>В эксперте</th>
                <th>Действия</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>

          <div class="pagination">
            <button id="registry-prev">‹</button>
            <span id="registry-page">1</span>
            <button id="registry-next">›</button>
          </div>
        </div>
      </section>
    </main>

    <div id="notification-container"></div>

    <div id="modal-overlay" class="modal-overlay hidden">
      <div class="modal">
        <div class="modal-header">
          <h3>Создание карточки</h3>
          <button id="modal-close" class="link-button">✕</button>
        </div>
        <div class="modal-body">
          <div class="form-grid">
            <label>
              Заголовок
              <input type="text" id="card-title-input" />
            </label>
            <label>
              Домен
              <select id="card-domain-input">
                <option value="">Выберите домен</option>
              </select>
            </label>
            <label>
              Владелец
              <select id="card-owner-input">
                <option value="">Выберите владельца</option>
              </select>
            </label>
            <label>
              Статус
              <select id="card-status-input">
                <option value="draft">draft</option>
                <option value="active">active</option>
                <option value="archived">archived</option>
              </select>
            </label>
            <label class="full-width">
              Описание / аннотация
              <textarea id="card-description-input" rows="4"></textarea>
            </label>
            <label class="full-width">
              Теги / ключевые слова
              <input type="text" id="card-tags-input" placeholder="через запятую (TODO)" />
            </label>
          </div>
        </div>
        <div class="modal-footer">
          <button id="modal-cancel" class="link-button">Отмена</button>
          <button id="modal-save" class="primary">Сохранить</button>
        </div>
      </div>
    </div>

    <script src="workbench.js"></script>
  </body>
</html>
